# 端口限速脚本

## 功能简介

这是一个基于 Linux 系统的端口限速脚本，使用 tc（traffic control）和 iptables 实现对指定端口的带宽限制。脚本可以针对特定端口设置总带宽限制和单个 IP 的限速配置。

## 前置要求

- Linux 操作系统
- `iproute2` 包（提供 tc 命令）
- `iptables` 包

## 功能特性

1. 设置端口限速
   - 可同时配置多个端口
   - 支持设置总带宽限制
   - 支持设置单个 IP 的限速
   - 支持设置最大速率上限

2. 清除限速规则
   - 支持清除所有限速规则
   - 支持清除指定端口的限速规则

3. 查看当前配置
   - 显示当前限速端口列表
   - 显示带宽配置详情

## 使用说明

### 1. 运行脚本

```bash
sudo bash port-speed-limit.sh
```

### 2. 选择操作

脚本提供三个主要功能：

1. 设置端口限速
2. 清除限速规则
3. 查看当前配置

### 3. 设置端口限速

选择选项 1 后，需要依次输入以下参数：

- 目标端口：多个端口用逗号分隔（例如：443,80,22）
- 总带宽：所有端口共享的总带宽，单位为 KBps
- 单个 IP 限速：每个 IP 地址的最大带宽限制，单位为 KBps
- 最大速率：允许的突发最大速率，单位为 KBps

### 4. 清除限速规则

选择选项 2 后，可以：

- 清除所有限速规则
- 清除指定端口的限速规则

### 5. 查看当前配置

选择选项 3 可以查看：

- 当前限速端口列表
- 带宽配置详情

## 配置文件

脚本会将配置信息保存在以下位置：

- `/tmp/traffic_ports`: 保存限速端口列表
- `/tmp/traffic_config`: 保存带宽配置信息

## 注意事项

1. 脚本需要 root 权限才能运行
2. 默认网卡名称为 eth0，如需修改请编辑脚本中的 `INTERFACE` 变量
3. 带宽限制单位统一为 KBps（千字节每秒）
4. 重启系统后需要重新配置限速规则

## 示例

### 设置端口限速示例

```bash
# 设置 80、443 端口限速
# 总带宽：1024 KBps
# 单个 IP 限速：512 KBps
# 最大速率：768 KBps

1. 选择选项 1
2. 输入端口：80,443
3. 输入总带宽：1024
4. 输入单个 IP 限速：512
5. 输入最大速率：768
```

### 清除特定端口限速示例

```bash
1. 选择选项 2
2. 选择选项 2（输入端口清除指定规则）
3. 输入要解除限速的端口：80,443
```
